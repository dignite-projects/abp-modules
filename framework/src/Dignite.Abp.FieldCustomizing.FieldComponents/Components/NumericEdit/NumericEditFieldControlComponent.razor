@using Dignite.Abp.FieldCustomizing.FieldComponents
@using Dignite.Abp.FieldCustomizing.Fields
@using Dignite.Abp.FieldCustomizing.Fields.NumericEdit
@using Dignite.Abp.FieldCustomizing
@inherits FieldControlComponentBase<NumericEditFieldProvider,NumericEditConfiguration>

<Validation Validator="@ValidateIsRequired">
    <Field Horizontal="@(!HideFieldLable)">
        <FieldLabel ColumnSize="ColumnSize.Is2.OnDesktop" hidden="@HideFieldLable">@CustomizeField.Definition.DisplayName</FieldLabel>
        <FieldBody ColumnSize="ColumnSize.Is10.OnDesktop">
            <NumericPicker TValue="decimal?" 
            Max="@Configuration.Max"
            Min="@Configuration.Min"
            Step="@Configuration.Step"
            Decimals="@Configuration.Decimals"
            Value="@value" 
            ValueChanged="@OnValueChanged"
            />
            <FieldHelp>@Configuration.Description</FieldHelp>
        </FieldBody>
    </Field>
</Validation>

@code{
    private decimal? value = null;

    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        if (CustomizeField.Entity.GetField(CustomizeField.Definition.Name, null) != null)
        {
            decimal convertValue;
            if (decimal.TryParse(CustomizeField.Entity.GetField(CustomizeField.Definition.Name, 0).ToString(), out convertValue))
            {
                value = convertValue;
            }
        }
    }



    void ValidateIsRequired( ValidatorEventArgs e )
    {
        var value = Convert.ToString( e.Value );
        if(Configuration.Required)
        {
            e.Status = string.IsNullOrWhiteSpace(value) ? ValidationStatus.Error : ValidationStatus.Success;
        }
    }

    Task OnValueChanged(decimal? value )
    {
        this.value = value;
        CustomizeField.Entity.SetField(CustomizeField.Definition.Name, value);

        return Task.CompletedTask;
    }
}