@using Dignite.Abp.FieldCustomizing.Components
@using Dignite.Abp.FieldCustomizing.Fields
@using Dignite.Abp.FieldCustomizing.Fields.Textbox
@using Dignite.Abp.FieldCustomizing;

@inherits FieldControlComponentBase<TextboxFieldProvider,TextboxConfiguration>

<Validation Validator="@ValidateIsRequired">
    <Field Horizontal="@(!HideFieldLable)">
        <FieldLabel ColumnSize="ColumnSize.Is2.OnDesktop" hidden="@HideFieldLable">@CustomizeField.Definition.DisplayName</FieldLabel>
        <FieldBody ColumnSize="ColumnSize.Is10.OnDesktop">
            @if (Configuration.Mode == TextboxMode.SingleLine)
            {
                <TextEdit Placeholder="@Configuration.Placeholder" MaxLength="@Configuration.CharLimit" Text="@CustomizeField.Entity.GetField(CustomizeField.Definition.Name)?.ToString()" TextChanged="@OnValueChanged">
                    <Feedback>
                        <ValidationError />
                    </Feedback>
                </TextEdit>
            }
            else
            {
                <MemoEdit Rows="5" AutoSize Placeholder="@Configuration.Placeholder" MaxLength="@Configuration.CharLimit" Text="@CustomizeField.Entity.GetField(CustomizeField.Definition.Name)?.ToString()" TextChanged="@OnValueChanged">
                    <Feedback>
                        <ValidationError />
                    </Feedback>
                </MemoEdit>
            }
            <FieldHelp>@Configuration.Description</FieldHelp>
        </FieldBody>
    </Field>
</Validation>


@code{


    void ValidateIsRequired( ValidatorEventArgs e )
    {
        var value = Convert.ToString( e.Value );
        if(Configuration.Required)
        {
            e.Status = string.IsNullOrWhiteSpace(value) ? ValidationStatus.Error : ValidationStatus.Success;
        }
    }

    Task OnValueChanged( string value )
    {
        CustomizeField.Entity.SetField(CustomizeField.Definition.Name, value);

        return Task.CompletedTask;
    }

}